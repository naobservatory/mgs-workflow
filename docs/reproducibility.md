# Running the pipeline reproducibly

Reproducibility is a key aspect of scientific research and development. It is possible to run the pipeline fully reproducibly, but doing so takes some specific steps. In particular, given consistent input data, the following is required to ensure that the pipeline produces the same output every time it is run:

1. A consistent **pipeline version**: These are recorded in this repository, allowing any past version to be accessed and run.
2. A consistent **configuration**: This is specified by the config file used to configure a pipeline run, which in turn sources several other config files from the `configs/` directory. The configuration of a past run is included in the run output at `output/input/params-run.json`. To run reproducibly, all configuration parameters should be in a consistent state, including:
    - Consistent *containers* for all processes: These are specified in `configs/containers.config` and should refer to specific and reproducible versions of all software (i.e. no "latest" container versions that might change with software updates).
    - A consistent (and non-empty) *random seed*, specified by `params.random_seed` in the config file.
3. A consistent **index**: This is produced by running the pipeline's [index workflow](./index.md) and includes many reference files used at different stages in the pipeline. Even if the run workflow is configured identically, different indexes can give rise to very different results. The parameters used to generate the index are included in the run output under `output/input/index-params.json`; unfortunately, even with identical parameters, it is **not currently possible to fully reproduce a previous index** if the current versions of some reference databases used in generating the index (e.g. Genbank, core_nt) have changed. As long as that remains true, the best way to ensure reproducibility is to use the exact same index directory as the one used in the original run, as specified by `params.ref_dir` in the config file.
4. A consistent **samplesheet**. As described [here](./usage.md#11-the-sample-sheet), the samplesheet is a CSV file that specifies the input data for the pipeline. It is stored in the pipeline output under `output/input/samplesheet.csv`.
