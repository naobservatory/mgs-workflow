/*
========================================================================================
    Nextflow config file for running tests
========================================================================================
*/

params {
    mode = "index"

    // Directories
    base_dir = "./" // Parent for working and output directories (can be S3)

    // Cow & E. coli
    genome_urls = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nucleotide&id=NZ_CP128970.1&rettype=fasta"

    // URLs for downloading reference genomes etc
    taxonomy_url = "https://ftp.ncbi.nlm.nih.gov/pub/taxonomy/taxdump_archive/taxdmp_2024-06-01.zip"
    virus_host_db_url = "https://www.genome.jp/ftp/db/virushostdb/virushostdb.tsv"

    // This is actually ecoli
    human_url = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nucleotide&id=NZ_CP128970.1&rettype=fasta"

    ssu_url = "https://www.arb-silva.de/fileadmin/silva_databases/release_138.1/Exports/SILVA_138.1_SSURef_NR99_tax_silva.fasta.gz"
    lsu_url = "https://www.arb-silva.de/fileadmin/silva_databases/release_138.1/Exports/SILVA_138.1_LSURef_NR99_tax_silva.fasta.gz"

    // Other reference files
    host_taxon_db = "${projectDir}/ref/host-taxa.tsv"
    contaminants = "${projectDir}/ref/contaminants.fasta.gz"
    genome_patterns_exclude =  "${projectDir}/ref/hv_patterns_exclude.txt"

    // Kraken DB - https://benlangmead.github.io/aws-indexes/k2
    kraken_db = "https://genome-idx.s3.amazonaws.com/kraken/k2_viral_20240904.tar.gz" // Path to tarball containing Kraken reference DB
    blast_db_name = "nt_others"

    // Can't do Circovirus, Anellovirus
    // Works Betacoronavirus
    ncbi_viral_params = "--section refseq --assembly-level complete --genera 'Rhinovirus'"

    //BBMAP memory; github action instances have 16 so keep it slightly lower
    bbmap_mem=12


    // Other input values
    virus_taxid = "10239"
    viral_taxids_exclude = "2731619 2732413 2732411" // Exclude Caudoviricetes, Malgrantaviricetes, Faserviricetes
    host_taxa_screen = "human" // Host taxa to screen for when building reference virus DB

    // Initializing run params to avoid warnings
    kraken_memory = ""
    classify_dedup_subset = ""
}

includeConfig "${projectDir}/configs/logging.config"
includeConfig "${projectDir}/configs/containers.config"
includeConfig "${projectDir}/configs/profiles.config"
includeConfig "${projectDir}/configs/output.config"

// Specify resources for processes based on labels
process {
    // Single-core processes
    withLabel: single {
        cpus = 1
        memory = 4.GB
    }

    // Small multi-core processes
    withLabel: small {
        cpus = 4
        memory = 8.GB
    }

    // Large multi-core processes
    withLabel: large {
        cpus = 4
        memory = 15.GB
    }

    // Very large multi-core processes
    withLabel: max {
        cpus = 4
        memory = 15.GB
    }
}

// What I need to do because I got error for touch .command.trace
// docker.fixOwnership = true
